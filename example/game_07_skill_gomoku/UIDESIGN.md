# UI 设计 

下面是为 《技能五子棋（Skill Gomoku）》 编写的 UI 设计方案 v1.0，我会严格结合你给的游戏截图、策划案的规则逻辑和交互需求，描述每个区域的布局、视觉风格、信息层级与操作逻辑。

## 一、整体风格定位

- 主题氛围：剑与魔法 × 东方棋道 → 结合炉石传说的魔法感 + 中国棋盘的规整感
- 画面结构：中心为棋盘，四周分布信息与卡组，保持视觉聚焦
- 主要色调：金色、青灰、深木色为主，辅以能量蓝、紫色光效区分卡种
- UI层级结构
  - 顶部横向带：从左到右依次为对手信息区、对手手牌区（卡背堆）、对手墓地/什刹海区，AI 状态条悬浮其上
  - 中央主舞台：棋盘居中，右侧贴靠对局日志栏，技能特效浮在棋盘上层
  - 底部横向带：从左到右依次为我方信息区、我方手牌区、我方墓地/什刹海区，确认按钮嵌在手牌区右端
  - 其他浮层：菜单、提示、弹窗等以遮罩/对话框形式叠加

## 二、主界面布局

> 所有 UI 应该在一屏范围内完成显示

1. 棋盘区（中央）

| 元素| 描述 |
|---|---|
| 棋盘样式| 15×15 标准棋盘，带轻微立体光影。格线使用青铜色；交叉点在棋盘上微微凸起。 |
| 棋子| 黑白棋子带能量光晕（受技能影响时颜色变化：冻结=蓝光，飞沙=沙尘特效）。 |
| 技能动画层| 每次技能发动时，棋盘中央上浮对应动画（如“飞沙走石”→沙尘卷起，目标棋子飞出屏幕并进入“什刹海”）。 |
| 落子引导| 当前可落点闪烁蓝光，AI 或我方操作结束后动画落子。 |
| 历史回溯指示| 鼠标悬停历史状态可显示“时光倒流”技能可选状态影像（微透明历史层）。 |

2. 对手区（顶部横带）

```
┌───────────────────────────────────────────────┐
│ [头像+状态带]   [卡背堆/抽牌动画]    [墓地 | 什刹海面板] │
└───────────────────────────────────────────────┘
```

| 元素| 描述 |
|---|---|
| 头像与状态条| 横带最左侧；头像外圈根据冻结、胜利等状态发光，旁侧堆叠一排紧凑的统计胶囊（手牌/落子/棋子/墓地/什刹海）。 |
| 手牌展示| 横带右侧保留一小块区域展示对手卡背扇形，抽牌时顶部触发轻微弹动。 |
| 墓地 / 什刹海面板| 横带旁挂一个细长面板按钮（墓地、什刹海），支持点击展开及 hover 缩略。 |
| AI 状态条| 悬浮在横带上方，保持简洁提示“AI 正在思考…”或对应阶段。 |

3. 我方区（底部横带）

```
┌───────────────────────────────────────────────┐
│ [头像+状态带]   [手牌扇形 & 提示 & 确认键]   [墓地 | 什刹海面板] │
└───────────────────────────────────────────────┘
```

| 元素| 描述 |
|---|---|
| 头像条| 仅保留一条 60px 左右的 info bar：头像 + 统计胶囊 + 提示文案“拖拽到棋盘即可发动”，整体无描边。 |
| 卡牌预览| 当 Hover/选中手牌时，在信息条右侧浮现卡面（上半部分覆在棋盘、下半部分压在 info bar 上），离开时收起。 |
| 手牌栏| 正面扇形贴在 info bar 正下方，支持拖拽到棋盘，提示不再单独占位。 |
| 墓地 / 什刹海面板| 与顶部同一风格，靠右悬浮。 |

4. 系统操作与日志区域

| 元素| 描述 |
|---|---|
| ⚙️ 菜单按钮| 棋盘左上角悬浮，提供重开、退出、查看说明等操作。 |
| 💬 对局记录区| 棋盘右侧竖向栏常驻显示最新行动，可折叠为窄条；支持滚动查看完整战报。 |

## 三、卡牌系统 UI

1. 卡牌结构（更新）

```
[ 技能名称 ]
[----------- 分隔线 -----------]
[   卡面插画   ]
[----------- 分隔线 -----------]
触发条件：xxx
技能效果：xxx
标签：稀有 / 需要角色...
- 台词
```

| 区域| 内容 |
|---|---|
| 顶部流线| 一条 Ribbon 条承载“类型/时机/战斗类型 + 稀有星级”，采用渐变色块与窄字体表现。 |
| 主插画| 保持 4:5 比例，卡框改为材质面性 + 内凹阴影。 |
| 文字区| “技能效果”“触发条件”分别独占段落，字体更大、行距 1.5，保证可读性。 |
| 标签 / 依赖| 统一为圆角徽章（例如“合体技”“需角色在场”），放在正文下方。 |
| 宣言/台词| 在底部单独成行，使用浅色引号样式。 |

2. 卡牌交互
- 悬停：显示详细信息（宣言、效果、稀有度）。
- 拖拽至棋盘：若为可选目标技能（如“飞沙走石”），可指向目标棋子后确认。
- 右键：查看关联的“反制卡”提示（显示哪些卡能反制当前技能）。

## 四、弹窗系统

| 弹窗类型| 功能 |
|---|---|
| 反击窗口（Counter Window）| 当对手发动技能时弹出：左侧显示对方技能动画，右侧显示自己可用的反击卡列表；倒计时 5 秒决定是否反击。 |
| 墓地浏览弹窗| 展示墓地中的卡牌列表，按使用顺序排列，可点击查看详情。 |
| 什刹海记录弹窗| 展示被移除棋子的编号、坐标、以及当时棋盘快照（小缩略图）。 |
| 胜负结算界面| 显示胜利动画（力拔山兮破碎棋盘 or 东山再起复苏棋盘）。 |

## 五、动画与特效建议

| 场景| 动画说明 |
|---|---|
| 飞沙走石| 一阵沙尘直奔目标棋子，卷起目标棋子飞离棋盘，飞入对方什刹海 |
| 力拔山兮| 整个棋盘震动、裂开、高高掀起然后反转后重重抛向地面 |
| 静如止水| 对方任务剧烈摇晃，虽然后淡蓝冰块爬上任务头像，棋子冻结 |
| 时光倒流| 棋盘快速回滚动画（悔棋），从最后两手依次淡出撤销；不恢复手牌/墓地/牌堆 |
| 东山再起| 金光从裂棋盘中央升起，棋盘重生 |
| 滚！| 对方释放的技能卡被推进 “一扇门” 动画 |


## 六、信息层级与 UX 节奏

- 主交互节奏：回合开始 → 抽卡提示 → 技能发动（可选）→ 落子 → 确认。
- 反击窗口优先级最高，中断当前动画，需即时反馈。
- 视觉焦点优先级：
    1. 棋盘（主战场） 
    2. 当前技能动画层 
    3. 卡牌栏 / 反击弹窗 
    4. 信息面板（墓地、什刹海） 

## 七、可扩展设计（后续版本）

- 角色语音系统：卡牌发动时触发角色语音，与宣言联动。
- 卡牌收集界面（主菜单）：展示所有解锁卡片，带语音试听。
- 回放系统：支持重看战局，查看每回合技能与棋盘变化。
- 观战模式：简化手牌区，仅展示棋盘和技能特效。

## 实施清单（v1.1 调整目标）

- [x] 重构顶/底横带布局：信息区、手牌区、墓地区依次排列，并保持一屏显示
- [x] 棋盘常驻渲染，开局引导改为覆盖式浮层
- [x] 重新设计卡牌结构（类型条、星级、主插画、文字信息、宣言条）
- [x] 调整对局日志为常驻右侧竖栏，可折叠
- [x] 统一状态条与提示带视觉，包含冻结/跳过等效果的高亮方案
- [x] 输出墓地 / 什刹海面板交互稿（列表、缩略卡、hover 提示）
- [x] 棋谱右上角显示回合信息（第 x 手 - 玩家回合）

## v1.2 交互增强（2025年11月实施）

### 已实现功能

#### 1. 棋谱交互优化

- **坐标标签化**：棋谱中的落子坐标从内联文字改为可悬停的标签
- **棋盘联动高亮**：鼠标悬停棋谱中的坐标标签时，棋盘上对应位置会显示紫色高亮
- **视觉层次**：标签使用 `border + bg-white/10` 设计，hover 时显示琥珀色边框和阴影
- **回合信息显示**：棋谱右上角显示"第 x 手 - 玩家回合"，使用 `turnCount` 和当前玩家名称动态显示

#### 2. 技能目标显示

- **反击决策时的目标高亮**：当玩家需要反击时，如果对方技能针对特定棋子（如飞沙走石），棋盘上会用红色圆环高亮显示被指定的位置
- **视觉强度**：使用红色高亮 + 光晕效果，确保目标清晰可见
- **状态提取**：从 `pendingAction.selection` 自动提取目标位置并高亮

#### 3. 位置封禁效果

- **封禁指示器**：被封禁的格子显示橙色圆形徽章，中央使用 SVG 绘制禁止图标（圆圈 + 斜线）
- **剩余回合数**：右下角显示橙色渐变小徽章，显示剩余封禁回合数
- **自动过期**：封禁效果通过比较 `expiresAtTurn` 与 `currentTurn` 自动判断是否过期
- **视觉规格**：
  - 主徽章：70% 格子大小，橙色渐变背景
  - SVG 图标：禁止符号（圆圈 + 对角线）
  - 倒计时徽章：白色文字，橙色渐变背景

#### 4. 右侧面板优化

- **改善 placeholder**：墓地和什刹海为空时显示居中的图标 + 提示文字，而不是简单的斜体文字
- **视觉一致性**：使用相应的图标（GraveIcon / SeaIcon）并降低透明度，配合友好提示文字
- **布局改善**：空状态时使用 flex 居中布局，提升视觉舒适度

#### 5. 界面高度修复

- **视口约束**：游戏舞台区域添加 `max-height: 100vh` 和 `overflow: hidden`
- **frame 高度**：游戏框架使用 `calc(100vh - padding)` 确保不超出视口
- **防止滚动**：整个游戏界面保持在一屏内，无需滚动

#### 6. 布局修复

- **网格布局**：修复了对方墓地区域位置错误的问题
- **正确的区域分配**：
  - 左上：对手信息区
  - 右上：对手墓地/什刹海区
  - 中央：棋盘（占两列）
  - 右侧：棋谱和玩家墓地/什刹海区
  - 底部：玩家信息和手牌区（占满）

#### 7. Bug 修复

- **棒球反击免疫**：检查技能参数中的 `ignoreSeize` 标记，防止带有此标记的技能（如棒球）被"拾金不昧"反击
- **飞沙走石回合跳过**：移除错误的 skip 计数器递增，确保只跳过当前回合
- **东山再起快照**：在技能 prepare 阶段创建 `preWinSnapshot`，确保反击时可以正确恢复棋盘状态

### 多层高亮系统

棋盘格子支持多种高亮状态，优先级从高到低：

1. **胜利连线** - 金黄色光晕
2. **最后落子** - 金黄色边框
3. **技能目标** - 红色圆环 + 光晕
4. **棋谱悬停** - 紫色边框
5. **目标选择** - 青色边框（目标）或玫瑰色边框（原点）
6. **位置封禁** - 橙色禁止徽章（覆盖在格子上方）

### 技术实现要点

#### 状态管理

```typescript
// 技能目标位置状态
const [skillTargetPosition, setSkillTargetPosition] = useState<{ row: number; col: number } | null>(null);

// 从 pendingAction 提取目标位置
useEffect(() => {
  if (gameState.pendingAction?.selection) {
    const sel = gameState.pendingAction.selection;
    if (typeof sel.row === 'number' && typeof sel.col === 'number') {
      setSkillTargetPosition({ row: sel.row, col: sel.col });
    }
  }
}, [gameState.pendingAction]);
```

#### 封禁检测

```typescript
// 检查格子是否被封禁
const sealedForPlayer = sealedCells.findIndex(
  cell => cell && cell.row === rowIdx && cell.col === colIdx && currentTurn < cell.expiresAtTurn
);
const isSealed = sealedForPlayer >= 0;
const remainingTurns = isSealed ? sealedCells[sealedForPlayer]!.expiresAtTurn - currentTurn : 0;
```

#### 棋谱坐标交互

```typescript
// GameLog 组件中的坐标标签
{hasPosition && (
  <span
    className="cursor-pointer rounded border border-amber-200/40 bg-white/10 px-1.5 py-0.5"
    onMouseEnter={() => onPositionHover(log.position!)}
    onMouseLeave={() => onPositionHover(null)}
  >
    {log.position!.row + 1},{log.position!.col + 1}
  </span>
)}
```

### 验收标准

- ✅ 棋谱坐标可 hover，联动棋盘高亮
- ✅ 反击时技能目标格子显示红色高亮
- ✅ 封禁格子显示禁止图标和剩余回合数
- ✅ 墓地/什刹海空状态显示友好提示
- ✅ 界面高度不超出浏览器视口
- ✅ 棒球免疫"拾金不昧"反击
- ✅ 飞沙走石只跳过当前回合
- ✅ 东山再起可正常恢复棋盘
- ✅ 棋谱右上角显示回合信息
- ✅ 布局正确：对方墓地区域在右上角，棋盘居中显示

### 后续优化方向
- [ ] 封禁格子的动画效果（脉冲/闪烁）
- [ ] 什刹海记录悬停时显示当时的棋盘快照
- [ ] 墓地记录悬停时显示卡牌详情
- [ ] 支持点击坐标标签跳转到对应回合

