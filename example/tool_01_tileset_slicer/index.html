<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>Tileset 切片工具 · tables</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <h1>Tileset 切片工具</h1>
      <p>上传图像素材，配置 tile 参数，导出 JSON/CSV 配置供 tables 使用。</p>
    </header>

    <main>
      <section class="controls">
        <div class="control-group">
          <label class="file-input">
            <span>选择素材图 (PNG/JPG)</span>
            <input id="fileInput" type="file" accept="image/png,image/jpeg,image/webp" />
          </label>
          <button id="resetBtn" type="button" class="ghost">清空</button>
        </div>

        <div class="preset-section">
          <span class="preset-label">候选 tileset</span>
          <div id="presetList" class="preset-list" role="list"></div>
        </div>

        <div class="control-grid">
          <label>
            <span>Tile 宽度</span>
            <input id="tileWidth" type="number" min="1" value="64" />
          </label>
          <label>
            <span>Tile 高度</span>
            <input id="tileHeight" type="number" min="1" value="64" />
          </label>
          <label>
            <span>边距 Margin</span>
            <input id="margin" type="number" min="0" value="0" />
          </label>
          <label>
            <span>间距 Spacing</span>
            <input id="spacing" type="number" min="0" value="0" />
          </label>
          <label>
            <span>ID 前缀</span>
            <input id="idPrefix" type="text" placeholder="tile" value="tile" />
          </label>
          <label>
            <span>起始索引</span>
            <input id="startIndex" type="number" value="0" />
          </label>
        </div>

        <div class="actions">
          <button id="exportJson" type="button">导出 JSON</button>
          <button id="exportCsv" type="button" class="ghost">导出 CSV</button>
          <button id="copyJson" type="button" class="ghost">复制 JSON</button>
          <span id="status" aria-live="polite"></span>
        </div>
      </section>

      <section class="workspace">
        <div class="canvas-wrapper">
          <canvas id="preview" width="640" height="480"></canvas>
          <div id="overlayInfo" class="overlay" hidden></div>
        </div>
        <aside class="summary">
          <h2>切片概览</h2>
          <dl>
            <div>
              <dt>原始尺寸</dt>
              <dd><span id="imgSize">—</span></dd>
            </div>
            <div>
              <dt>列 × 行</dt>
              <dd><span id="gridCount">—</span></dd>
            </div>
            <div>
              <dt>Tile 总数</dt>
              <dd><span id="tileCount">0</span></dd>
            </div>
          </dl>
          <h3>预览列表</h3>
          <div id="tileList" class="tile-list"></div>
        </aside>
      </section>

      <section class="tile-tools">
        <div class="connectivity-panel">
          <h2>联通标注</h2>
          <p class="hint">选择某个 tile 后，点击方向按钮标记可连通的边。</p>
          <div class="direction-grid" aria-live="polite">
            <button type="button" data-dir="nw" class="dir-btn" title="西北">↖</button>
            <button type="button" data-dir="n" class="dir-btn" title="北">↑</button>
            <button type="button" data-dir="ne" class="dir-btn" title="东北">↗</button>
            <button type="button" data-dir="w" class="dir-btn" title="西">←</button>
            <div class="dir-center" id="selectedTileLabel">未选中 tile</div>
            <button type="button" data-dir="e" class="dir-btn" title="东">→</button>
            <button type="button" data-dir="sw" class="dir-btn" title="西南">↙</button>
            <button type="button" data-dir="s" class="dir-btn" title="南">↓</button>
            <button type="button" data-dir="se" class="dir-btn" title="东南">↘</button>
          </div>
        </div>

        <div class="board-panel">
          <h2>画板</h2>
          <p class="hint">使用当前选中的 tile 在画板上绘制地图。</p>
          <div class="board-controls">
            <label>
              <span>列数</span>
              <input id="boardCols" type="number" min="1" value="8" />
            </label>
            <label>
              <span>行数</span>
              <input id="boardRows" type="number" min="1" value="8" />
            </label>
            <button id="resizeBoard" type="button">调整画板</button>
            <button id="clearBoard" type="button" class="ghost">清空画板</button>
          </div>
          <div class="board-wrapper">
            <canvas id="boardCanvas" width="512" height="512" role="img" aria-label="tileset 画板"></canvas>
          </div>
          <div class="board-actions">
            <button id="exportBoardJson" type="button">导出画板 JSON</button>
            <span id="boardStatus" aria-live="polite"></span>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <small>
        导出的 JSON 结构：{ "tiles": [{ "id": string, "x": number, "y": number, "width": number, "height": number }],
        "meta": { width, height, tileWidth, tileHeight, margin, spacing }}。
      </small>
    </footer>

    <script src="script.js" type="module"></script>
  </body>
</html>
